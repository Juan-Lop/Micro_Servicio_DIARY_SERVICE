services:
  # Microservicio Diary Service
  - type: web
    name: diary-service
    runtime: docker
    plan: free
    region: oregon

    # Health Check endpoint
    healthCheckPath: /actuator/health

    # Variables de entorno
    envVars:
      # Puerto (Render asigna automáticamente)
      - key: PORT
        value: 8082

      # Base de datos PostgreSQL
      - key: DB_HOST
        fromDatabase:
          name: diary-db
          property: host

      - key: DB_PORT
        fromDatabase:
          name: diary-db
          property: port

      - key: DB_NAME
        fromDatabase:
          name: diary-db
          property: database

      - key: DB_USERNAME
        fromDatabase:
          name: diary-db
          property: user

      - key: DB_PASSWORD
        fromDatabase:
          name: diary-db
          property: password

      # JWT Secret (debe ser la misma que en Auth Service)
      - key: JWT_SECRET_KEY
        sync: false  # Configurar manualmente en Render Dashboard

      # Google Gemini API
      - key: GEMINI_API_KEY
        sync: false  # Configurar manualmente en Render Dashboard

      - key: GEMINI_API_URL
        value: https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent

      # CORS - orígenes permitidos (separados por coma)
      - key: CORS_ALLOWED_ORIGINS
        value: http://localhost:5174,http://localhost:3000

      # Configuración de JPA/Hibernate
      - key: HIBERNATE_DDL_AUTO
        value: update

      - key: SHOW_SQL
        value: false

      # Logging
      - key: LOG_LEVEL
        value: INFO

      - key: LOG_LEVEL_SPRING_WEB
        value: WARN

      - key: LOG_LEVEL_HIBERNATE
        value: WARN

      # Opciones de JVM
      - key: JAVA_OPTS
        value: "-Xmx512m -Xms256m"

# Base de datos PostgreSQL
databases:
  - name: diary-db
    plan: free
    databaseName: diary_db
    user: diary_user
